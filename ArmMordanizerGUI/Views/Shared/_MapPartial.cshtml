@model Mapper
@{
    var i = 0;
}

@*    <label>Model.sourceTablename</label>
*@
@*@for (i = 0; i < Model.mapTables.Count; i++)
    {


    <div class="row pt-12" style="border:dashed;padding-top:10px;">
    <div class="row pt-6">
    <div class="col-4">
    <h2 class="text-primary">Source Column</h2>
    </div>
    <div class="col-8">
    @Html.DropDownListFor(m => m.mapTables[i].sourceColumn, new SelectList(Model.sourceSelectList, "Text", "Value"), new { @class = "form-control" })
    </div>
    </div>
    <div class="row pt-6">
    <div class="col-4">
    <h2 class="text-primary">Destination Column</h2>
    </div>
    <div class="col-8">
    @Html.DropDownListFor(m => m.mapTables[i].targetColumn, new SelectList(Model.desTinationSelectList, "Text", "Value"), new { @class = "form-control" })
    </div>
    </div>
    </div>
    }*@
@Html.Hidden("HiddenId",Model.mapTables.Count)
@Html.Hidden("HiddenId2","")
<div class="row">
    <div class="col-md-8">
        @if (TempData["message"] != null)
        {
            <div class="alert alert-warning alert-dismissible fade show" role="alert">
                <div>@TempData["message"]</div>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }
    </div>
    <div class="col-md-4">
        <div title="Tick the box if you wish to remove records in the destination table before appending new ones." class="row">
            <div class="col-md-10">
                <label class="text-primary">Purge Before Insert</label>
            </div>
            <div class="col-md-2">
                @Html.CheckBoxFor(m => m.PurgeBeforeInsert)
            </div>
        </div>
    </div>
</div>

<div class="row pt-12" style="border:none;padding-top:10px;">
    <table class="table table-bordered">
        <thead>
            <tr>
                <th class="text-primary text-center">Source Column</th>
                <th class="text-primary text-center">Destination Column</th>
                <th class="text-primary text-center">Status</th>
                <th class="text-primary text-center">Prevent Duplicates</th>
            </tr>
        </thead>
        <tbody>
            @for (i = 0; i < Model.mapTables.Count; i++)
            {
                SelectList? source = Model.mapTables[i].SourceColumns;
                SelectList? destination = Model.mapTables[i].TargetColumns;
                <tr>
                    <td>
                        @Html.DropDownListFor(m => m.mapTables[i].sourceColumn, source , new {@id = "SourceId"+i, @class = "form-select",onchange="SourceFieldNameChanged("+i+")"})
                        @*                        @Html.DropDownListFor(m => m.mapTables[i].sourceColumn, new SelectList(Model.sourceSelectList, "Text", "Value"), new {@id = "Id"+i, @class = "form-control",@onchange = "test3("+i+","+ Model.mapTables.Count +")"  })
                    *@
                    </td>
                    <td>
                        @Html.DropDownListFor(m => m.mapTables[i].targetColumn, destination, new { @id="DestinationId"+i, @class = "form-select",onchange="SourceFieldNameChanged("+i+")" })
                    </td>
                    <td style="color:white" class="p-3">
                        @if (Model.mapTables[i].Status != null)
                        {
                            <div id="status@(i)"><span>@Html.Raw(@Model.mapTables[i].Status)</span></div>
                        }
                    </td>
                    <td title="Prevent duplicates by appending the row number of the duplicate.">
                        @if (Model.mapTables[i].TargetColumnType?.ToLower() == "nvarchar" && Model.mapTables[i].sourceColumn != "<ignore>")
                        {
                            @Html.CheckBoxFor(m => m.mapTables[i].PreventDuplicates, new {@class="prevent-duplicates"})
                        }
                    </td>
                </tr>

            }
        </tbody>
    </table>

</div>
<br />
<br />
@if (Model.mapTables.Count == 0)
{
    <h2 class="text-warning"><b>Configuration data not found. Please select Re Use option "NO" to insert data first.</b></h2>
}
@if (Model.mapTables.Count > 0)
{
    <button type="submit" class="btn btn-outline-primary btn-lg" onclick="ShowSpinner()">Submit</button>
}
@if (Model.mapTables.Count > 0)
{
    <button type="reset" class="btn btn-outline-secondary btn-lg" onclick="location.href='@Url.Action("Reset", "Mapping")'"> Reset </button>
}
<script>
    $('.prevent-duplicates').on('click', function () {
        $('.prevent-duplicates').not(this).prop('checked', false);
    });

</script>
